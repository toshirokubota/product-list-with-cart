<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- displays site properly based on user's device -->

  <link rel="icon" type="image/png" sizes="32x32" href="./assets/images/favicon-32x32.png">

  <title>Frontend Mentor | Product list with cart</title>

  <!-- Feel free to remove these styles or customise in your own stylesheet 👍 -->
  <link rel="stylesheet" href="style.css">
  <style>
    .attribution {
      font-size: 11px;
      text-align: center;
    }

    .attribution a {
      color: hsl(228, 45%, 44%);
    }
  </style>
</head>

<body>
  <h1>
    Desserts
  </h1>
  <main>
    <div id="dessert-menu">
    </div>
    <div id="cart-area">
      <div id="cart-box">
        <h4 id="cart-summary">
          Your Cart (<span class="order-total-count"></span>)
        </h4>
        <!-- <div id="added-items">
          <img src="./assets/images/illustration-empty-cart.svg"/>
          Your added items will appear here
        </div>     -->
        <!-- <div class="cart-entry">
          dessert name, count, price, total
        </div> -->
        <div class="order-entry">
          <div class="order-entry-detail">
            <div class="dessert-name">Waffle with Berries</div>
            <div>
              <span class="order-entry-count">1&times</span>
              <span class="order-entry-price">@ $4.00</span>
              <span class="order-entry-subtotal">$4.00</span>  
            </div>
          </div>
          <div class="remove-item">
            <img src="./assets/images/icon-remove-item.svg"/>
          </div>
        </div>
        <div id="cart-cost-total">
          <span>Order total</span>
          <span id="order-total-dollar">$234.99</span>
        </div>
        <div class="carbon-neutral">
          <img src="./assets/images/icon-carbon-neutral.svg"/>
          This is a <emp>carbon-neutral</emp> delivery
        </div>
        <div class="comfirm-order-button">Confirm Order</div>
      </div>
    </div>
  </main>

  <div class="attribution">
    Challenge by <a href="https://www.frontendmentor.io?ref=challenge">Frontend Mentor</a>.
    Coded by <a href="#">Your Name Here</a>.
  </div>
</body>

<script>
  var desserts;
  initialize();

  const incrementCount = (dessert)=> {
    dessert.count += 1;
    console.log('incrementing' + dessert.name + 'to ' + dessert.count);
    if(dessert.count == 1) {
      dessert.node.button_empty.style.display = 'none';
      dessert.node.button_nonempty.style.display = 'flex';
      dessert.node.photo.style.border = 'solid 1px hsl(14, 86%, 42%)';
      console.log('switch buttons');
    }
    dessert.num.innerText = '' + dessert.count;
    updateCart(desserts);
  }
  const decrementCount = (dessert)=> {
    dessert.count -= 1;
    console.log('incrementing' + dessert.name + 'to ' + dessert.count);
    if(dessert.count == 0) {
      dessert.node.button_empty.style.display = 'flex';
      dessert.node.button_nonempty.style.display = 'none';
      dessert.node.photo.style.border = 'none';
      console.log('switch buttons');
    }
    dessert.num.innerText = '' + dessert.count;
    updateCart(desserts);
  }

  const buttonWhenEmpty = (dessert) => {
    const box = document.createElement('div');
    box.classList.add('button-empty-container')
    let icon = document.createElement('img');
    icon.classList.add('empty-icon');
    icon.src = './assets/images/icon-add-to-cart.svg';
    box.addEventListener('click', (e)=> { incrementCount(dessert)});
    box.appendChild(document.createTextNode('Add to Cart'));
    box.appendChild(icon);
    return box;
  }
  const buttonWhenNotEmpty = (dessert) => {
    const box = document.createElement('div');
    box.classList.add('button-nonempty-container')
    let icon = document.createElement('img');
    icon.src = './assets/images/icon-increment-quantity.svg';
    icon.classList.add('increment-icon');
    icon.addEventListener('click', (e)=> { incrementCount(dessert)});
    box.appendChild(icon);

    let num = document.createElement('span');     
    num.classList.add('count-num');
    num.appendChild(document.createTextNode('' + dessert.count));
    box.appendChild(num);
    dessert.num = num; //I am not sure if I want to do this way for updating the count

    let icon2 = document.createElement('img');
    icon2.src = './assets/images/icon-decrement-quantity.svg';
    icon2.classList.add('decrement-icon');
    icon2.addEventListener('click', (e)=> { decrementCount(dessert)});
    box.appendChild(icon2);
    return box;
  }

  const updateCart = (desserts) => {
    let count = 0;
    let total = 0;
    for(let dessert of desserts) {
      count += dessert.count;
      total += dessert.count * dessert.price;
      if(dessert.count > 0) {

      }
    }
    let summary = document.getElementById('cart-summary');
    summary.innerHTML = 'Your Cart (<span class="quantity">' + count + '</span>)';
  }

  async function initialize() {
    desserts = await getData();
    console.log(desserts);
    for(let dessert of desserts) {
      dessert.count = 0;
    }
    let main = document.getElementById('dessert-menu');
    for(let dessert of desserts) {
      let item = document.createElement('div');
      item.classList.add('dessert-item');
      //add photo
      let photo = document.createElement('div');
      photo.classList.add('dessert-photo');
      let img = document.createElement('img');
      //add thumb nail photo based on the screen size
      if(window.innerWidth <= 450) img.src = dessert.image.mobile;
      else if(window.innerWidth < 1024) img.src = dessert.image.tablet;
      else img.src = dessert.image.desktop;
      photo.appendChild(img);
      item.appendChild(photo);

      //add category
      let category = document.createElement('h3');
      category.classList.add('dessert-category');
      category.appendChild(document.createTextNode(dessert.category));
      item.appendChild(category);
      //add name 
      let name = document.createElement('h2');
      name.appendChild(document.createTextNode(dessert.name));
      name.classList.add('dessert-name');
      item.appendChild(name);
      //add price
      let price = document.createElement('div');
      price.classList.add('dessert-price');
      price.appendChild(document.createTextNode('$' + parseFloat(dessert.price).toFixed(2)));
      item.appendChild(price);
      //add button
      let box = document.createElement('div');
      box.classList.add('cart-updator');
      let button1 = buttonWhenEmpty(dessert);
      let button2 = buttonWhenNotEmpty(dessert);
      button1.style.display = 'flex';
      button2.style.display = 'none';
      box.appendChild(button1);
      box.appendChild(button2);
      item.appendChild(box);

      main.appendChild(item);
      //add DOM elements to facilitate visual update
      dessert.node = { button_empty: button1, button_nonempty: button2, box: box, photo: img};
    }
  }

  const initializeCart = (desserts) => {
    let container = document.getElementById('cart-area');
    let box = document.createElement('div');
    box.id = 'cart-box';
    container.appendChild(box);
    let empty_cart = document.createElement('div');
    empty_cart.innerHTML = `        
        <h4 id="cart-summary">
          Your Cart (<span class="quantity"><!-- Quantity --></span>)
        </h4>
        <div id="added-items">
          <img src="./assets/images/illustration-empty-cart.svg"/>
          Your added items will appear here
        </div>    
        `;
    box.appendChild(empty_cart);

    for(let dessert of desserts) {
      let entry = document.createElement('div');
      entry.classList.add('cart-entry');
      entry.innerHTML = dessert.name + " x" + dessert.count + " $" + dessert.price + " $" + (dessert.count * dessert.price).toFixed(2);
      entry.style.display = 'none';
      box.appendChild(entry);
      dessert.cart_entry = entry;
    }

  }

  async function getData() {
    const res = await fetch('./data.json');
    const data = await res.json();

    return data;
  }
</script>

</html>